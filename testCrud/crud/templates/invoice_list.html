
{% extends "base.html" %}

{% block content %}
{% csrf_token %}
<div class="container-fluid">
    <div class="row py-5 justify-content-md-center">
        <h1>Facturas</h1>
        <div class="col">
            <div class="card">
                <ul class="list-group list-group-flush">
                {% for invoice in invoices_not_download %}
                    <li class="list-group-item d-flex justify-content-between align-items-center" id="invoice-{{ invoice.id }}">
                        <strong>{{ invoice.title }}</strong> {{ invoice.description }}
                        <button name="action" value="delete" type="submit" class="btn btn-danger delete-invoice" data-id="{{invoice.id}}">Borrar</button>
                    </li>
                {% empty %}
                    <li class="list-group-item">No hay facturas guardadas.</li>
                {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
{% block script%}
<script>
    // Borrar Factura
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".delete-invoice").forEach(button => {
            button.addEventListener("click", function() {
                let invoiceId = this.getAttribute("data-id");
                
                fetch("{% url 'crud:invoice_delete' %}", {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ "invoice_id": invoiceId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById(`invoice-${invoiceId}`).remove(); // Eliminar de la UI
                    } else {
                        alert("Error al eliminar la factura.");
                    }
                })
                .catch(error => console.error("Error:", error));
            });
        });
    });
</script>

{% endblock script%}